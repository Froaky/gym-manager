{% extends "base.html" %}

{% block title %}Rutinas de {{ target_user.name }} - Gym Manager{% endblock %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1>Rutinas de {{ target_user.name }}</h1>
    <a href="/users" class="btn" style="background: var(--surface); color: var(--text);">Volver</a>
</div>

<div class="card" style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
    <h3>Rutinas Asignadas</h3>
    <button onclick="document.getElementById('assignRoutineModal').style.display='flex'" class="btn">
        + Asignar Rutina
    </button>
</div>

<!-- Modal Asignar Rutina -->
<div id="assignRoutineModal"
    style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; z-index: 100;">
    <div class="card" style="width: 100%; max-width: 500px; position: relative;">
        <span onclick="document.getElementById('assignRoutineModal').style.display='none'"
            style="position: absolute; top: 1rem; right: 1rem; cursor: pointer; font-size: 1.5rem;">&times;</span>
        <h2 style="margin-bottom: 1.5rem;">Asignar Rutina a {{ target_user.name }}</h2>

        <form action="/routines/assign" method="POST">
            <input type="hidden" name="user_id" value="{{ target_user.id }}">

            <div style="margin-bottom: 1.5rem;">
                <label style="display: block; margin-bottom: 0.5rem;">Seleccionar Plantilla</label>
                <select name="routine_id" required
                    style="width: 100%; padding: 0.75rem; border-radius: 0.375rem; background: #0f172a; border: 1px solid #334155; color: white;">
                    <option value="" disabled selected>Elige una rutina...</option>
                    {% for r in all_routines %}
                    <option value="{{ r.id }}">{{ r.name }}</option>
                    {% endfor %}
                </select>
            </div>

            <button type="submit" class="btn" style="width: 100%;">Asignar</button>

            <div style="margin-top: 1rem; text-align: center;">
                <a href="/routines" style="color: var(--primary);">Gestionar Plantillas</a>
            </div>
        </form>
    </div>
</div>

<div style="display: grid; gap: 1rem;">
    {% for routine in routines %}
    <div class="card" style="display: flex; justify-content: space-between; align-items: center;">
        <div>
            <h2 style="margin: 0; font-size: 1.25rem;">
                <a href="/routines/{{ routine.id }}" style="color: var(--primary); text-decoration: none;">{{
                    routine.name }}</a>
            </h2>
            {% if routine.description %}
            <p style="margin: 0.5rem 0 0; color: var(--text-muted); font-size: 0.875rem;">{{ routine.description }}</p>
            {% endif %}
            <small style="color: var(--text-muted);">{{ routine.exercises|length }} Ejercicios</small>
        </div>
        <form action="/routines/unassign" method="POST" onsubmit="return confirm('Â¿Quitar esta rutina del usuario?');">
            <input type="hidden" name="user_id" value="{{ target_user.id }}">
            <input type="hidden" name="routine_id" value="{{ routine.id }}">
            <button type="submit"
                style="background: none; border: none; color: #ef4444; cursor: pointer;">Desasignar</button>
        </form>
    </div>
    {% else %}
    <p style="text-align: center; color: var(--text-muted);">Este usuario no tiene rutinas asignadas.</p>
    {% endfor %}
</div>
{% endblock %}